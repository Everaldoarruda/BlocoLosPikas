<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CAMISA LOS PIKAS E LAS PERIKITAS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');

        body {
            font-family: 'Inter', sans-serif;
        }

        .glass {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        @media print {

            /* Hide non-printable elements */
            #adminTools,
            #adminStatusIndicator,
            button,
            .no-print,
            header button,
            .fa-trash,
            .fa-pen {
                display: none !important;
            }

            /* Hide Table Actions Column */
            th:last-child,
            td:last-child {
                display: none !important;
            }

            /* Layout adjustments */
            body,
            main,
            #appContainer {
                height: auto !important;
                overflow: visible !important;
                background: white !important;
            }

            header {
                border-bottom: 2px solid #000 !important;
                padding-bottom: 10px !important;
                margin-bottom: 20px !important;
                box-shadow: none !important;
            }

            /* Ensure text is black */
            * {
                color: black !important;
                text-shadow: none !important;
            }

            /* Keep Status Colors if possible, otherwise bold */
            .bg-green-100 {
                background-color: #dcfce7 !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }

            .bg-red-100 {
                background-color: #fee2e2 !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }

            .bg-yellow-100 {
                background-color: #fef9c3 !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
        }
    </style>
</head>

<body class="bg-slate-100 text-slate-800 h-screen flex flex-col overflow-hidden">

    <!-- LOGIN MODAL (VISITANTE) -->
    <div id="loginOverlay" class="fixed inset-0 z-50 bg-slate-900 flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-2xl p-8 max-w-sm w-full text-center">
            <div class="mb-6">
                <i class="fas fa-users text-4xl text-blue-600"></i>
            </div>
            <h2 class="text-2xl font-bold mb-2">Camisas Los Pika e Las Perikitas</h2>
            <p class="text-gray-500 mb-6 text-sm">Digite a senha de acesso (visitante).</p>
            <input type="password" id="passwordInput" placeholder="Senha de acesso"
                class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition mb-4 text-center text-lg">
            <button onclick="attemptLogin()"
                class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg transition transform active:scale-95">
                Entrar
            </button>
            <p id="loginError" class="text-red-500 text-xs mt-3 hidden">Senha incorreta.</p>

        </div>
    </div>

    <!-- PIX MODAL -->
    <div id="pixModal"
        class="fixed inset-0 z-[60] bg-black/80 hidden flex items-center justify-center p-4 backdrop-blur-sm">
        <div
            class="bg-white rounded-xl shadow-2xl p-6 max-w-xs w-full text-center relative animate-[fadeIn_0.2s_ease-out]">
            <button onclick="closePixModal()"
                class="absolute top-2 right-3 text-gray-400 hover:text-gray-600 transition">
                <i class="fas fa-times"></i>
            </button>
            <div class="mb-3 text-emerald-500">
                <i class="fa-brands fa-pix text-4xl"></i>
            </div>
            <h3 class="text-lg font-bold mb-1 text-slate-800">Pagamento Pix</h3>
            <p class="text-xs text-gray-500 mb-4">Copie a chave abaixo para pagar.</p>

            <div class="bg-slate-50 p-3 rounded-lg flex items-center justify-between mb-4 border border-slate-200 group cursor-pointer hover:border-emerald-300 transition"
                onclick="copyPix()">
                <span class="text-xs font-mono text-gray-600 truncate mr-2 select-all"
                    id="pixKeyDisplay">81985900577</span>
                <i class="fas fa-copy text-gray-400 group-hover:text-emerald-500"></i>
            </div>

            <button id="btnCopyPix" onclick="copyPix()"
                class="w-full bg-slate-800 hover:bg-slate-900 text-white font-bold py-2.5 rounded-lg transition flex items-center justify-center gap-2 shadow-lg">
                <i class="fas fa-copy"></i> Copiar Chave
            </button>
        </div>
    </div>

    <!-- ADMIN AUTH MODAL -->
    <div id="adminAuthModal"
        class="fixed inset-0 z-[60] bg-black/80 hidden flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white rounded-xl shadow-2xl p-6 max-w-xs w-full text-center relative">
            <button onclick="closeAdminModal()" class="absolute top-2 right-3 text-gray-400 hover:text-gray-600"><i
                    class="fas fa-times"></i></button>
            <div class="mb-4 text-red-500">
                <i class="fas fa-user-shield text-3xl"></i>
            </div>
            <h3 class="text-lg font-bold mb-1">Acesso Administrativo</h3>
            <p class="text-xs text-gray-500 mb-4">Esta ação requer a senha de administrador.</p>

            <input type="password" id="adminPasswordInput" placeholder="Senha Admin"
                class="w-full px-3 py-2 rounded border border-gray-300 focus:border-red-500 focus:ring-1 focus:ring-red-200 outline-none mb-3 text-center">

            <button onclick="verifyAdminPassword()"
                class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-2 rounded transition">
                Liberar Acesso
            </button>
            <p id="adminError" class="text-red-500 text-[10px] mt-2 hidden">Senha incorreta.</p>
        </div>
    </div>

    <!-- DELETE CONFIRMATION MODAL -->
    <div id="deleteModal"
        class="fixed inset-0 z-[80] bg-black/50 hidden flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white rounded-xl shadow-2xl p-6 max-w-sm w-full text-center">
            <div class="mb-4 text-red-500 bg-red-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto">
                <i class="fas fa-trash-alt text-2xl"></i>
            </div>
            <h3 class="text-lg font-bold mb-2 text-gray-800">Excluir Pedido?</h3>
            <p class="text-sm text-gray-500 mb-6">Esta ação não pode ser desfeita. Tem certeza que deseja remover este
                item?</p>

            <input type="hidden" id="deleteTargetId">

            <div class="flex gap-3">
                <button onclick="closeDeleteModal()"
                    class="flex-1 px-4 py-2 rounded-lg text-gray-600 bg-gray-100 hover:bg-gray-200 font-medium transition">
                    Cancelar
                </button>
                <button onclick="confirmDelete()"
                    class="flex-1 px-4 py-2 rounded-lg bg-red-600 text-white font-bold hover:bg-red-700 shadow-lg transition">
                    Excluir
                </button>
            </div>
        </div>
    </div>

    <!-- IMAGE PREVIEW MODAL -->
    <div id="imageModal"
        class="fixed inset-0 z-[70] bg-black/90 hidden flex items-center justify-center p-4 backdrop-blur-md"
        onclick="closeImageModal()">
        <div class="relative max-w-3xl w-full" onclick="event.stopPropagation()">
            <button onclick="closeImageModal()"
                class="absolute -top-12 right-0 text-white hover:text-gray-300 text-2xl transition">
                <i class="fas fa-times"></i>
            </button>
            <img id="previewImage" src="" alt="Camisa"
                class="w-full h-auto rounded-lg shadow-2xl border-4 border-white/20">
            <p id="previewCaption" class="text-white text-center mt-4 font-bold text-lg tracking-wider"></p>
        </div>
    </div>

    <!-- MAIN APP (Hidden by default) -->
    <div id="appContainer" class="hidden h-full flex flex-col">

        <!-- Header -->
        <header
            class="bg-white border-b border-gray-200 px-6 py-4 flex flex-col md:flex-row justify-between items-center shadow-sm z-10">
            <div class="flex items-center gap-3 mb-4 md:mb-0">
                <div class="bg-blue-100 p-2 rounded-lg">
                    <i class="fas fa-tshirt text-blue-600 text-xl"></i>
                </div>
                <div>
                    <h1 class="text-xl font-bold text-slate-800">Camisas Los Pika e Las Perikitas</h1>
                    <div class="flex items-center gap-2 text-xs text-slate-500">
                        <span>Lista Oficial (Local)</span>
                        <span id="adminStatusIndicator"
                            class="hidden bg-red-100 text-red-600 px-2 py-0.5 rounded-full font-bold text-[10px] border border-red-200">
                            <i class="fas fa-check"></i> MODO ADMIN
                        </span>
                    </div>
                </div>
            </div>

            <div class="flex gap-4 items-center">
                <div class="text-right mr-4">
                    <p class="text-xs text-gray-500 uppercase font-semibold">Arrecadado</p>
                    <p class="text-2xl font-bold text-green-600" id="totalValueDisplay">R$ 0,00</p>
                </div>

                <div class="text-right border-l pl-4 border-gray-200 hidden sm:block">
                    <p class="text-xs text-gray-500 uppercase font-semibold">Total Geral</p>
                    <p class="text-xl font-bold text-gray-500" id="totalForecastDisplay">R$ 0,00</p>
                </div>

                <div class="text-right border-l pl-4 border-gray-200">
                    <p class="text-xs text-gray-500 uppercase font-semibold">Peças</p>
                    <p class="text-xl font-bold text-blue-600" id="totalItemsDisplay">0</p>
                </div>

                <!-- Admin Tools (Hidden by default) -->
                <div id="adminTools" class="hidden flex items-center gap-2 ml-2">
                    <button onclick="downloadBackup()"
                        class="bg-slate-100 hover:bg-slate-200 text-slate-600 px-3 py-2 rounded-lg transition border border-slate-200"
                        title="Baixar JSON (Backup)">
                        <i class="fas fa-download"></i>
                    </button>
                    <button onclick="window.print()"
                        class="bg-slate-100 hover:bg-slate-200 text-slate-800 px-3 py-2 rounded-lg transition border border-slate-200"
                        title="Imprimir Lista">
                        <i class="fas fa-print"></i>
                    </button>
                    <button onclick="exitAdminMode()"
                        class="bg-red-50 hover:bg-red-100 text-red-500 px-3 py-2 rounded-lg transition border border-red-100"
                        title="Sair do Modo Admin">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>

                <button onclick="openPixModal()"
                    class="bg-emerald-500 hover:bg-emerald-600 text-white px-4 py-2 rounded-lg shadow-lg flex items-center gap-2 transition hover:-translate-y-0.5 mr-2">
                    <i class="fa-brands fa-pix"></i> <span class="hidden md:inline">Pagar Pix</span>
                </button>

                <button id="btnMainAction" onclick="handleMainAction()"
                    class="ml-2 bg-slate-700 hover:bg-slate-800 text-white px-4 py-2 rounded-lg shadow-lg flex items-center gap-2 transition hover:-translate-y-0.5">
                    <i class="fas fa-user-cog"></i> <span class="hidden md:inline">Gerenciar</span>
                </button>
            </div>
        </header>

        <!-- Content -->
        <main class="flex-1 overflow-auto p-4 md:p-6">
            <div class="max-w-7xl mx-auto">

                <!-- Main Stats Cards -->
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                    <div
                        class="bg-white p-4 rounded-xl shadow-sm border border-gray-100 flex items-center justify-between">
                        <div>
                            <p class="text-xs text-gray-500 font-bold uppercase">Pagos</p>
                            <h3 class="text-2xl font-bold text-green-600" id="countPaid">0</h3>
                        </div>
                        <i class="fas fa-check-circle text-green-100 text-3xl"></i>
                    </div>
                    <div
                        class="bg-white p-4 rounded-xl shadow-sm border border-gray-100 flex items-center justify-between">
                        <div>
                            <p class="text-xs text-gray-500 font-bold uppercase">Pendentes</p>
                            <h3 class="text-2xl font-bold text-red-500" id="countPending">0</h3>
                        </div>
                        <i class="fas fa-clock text-red-100 text-3xl"></i>
                    </div>
                    <div
                        class="bg-white p-4 rounded-xl shadow-sm border border-gray-100 flex items-center justify-between">
                        <div>
                            <p class="text-xs text-gray-500 font-bold uppercase">Verdes</p>
                            <h3 class="text-2xl font-bold text-emerald-600" id="countGreen">0</h3>
                        </div>
                        <div class="w-8 h-8 rounded-full bg-emerald-100 flex items-center justify-center">
                            <div class="w-4 h-4 rounded-full bg-green-600"></div>
                        </div>
                    </div>
                    <div
                        class="bg-white p-4 rounded-xl shadow-sm border border-gray-100 flex items-center justify-between">
                        <div>
                            <p class="text-xs text-gray-500 font-bold uppercase">Azuis</p>
                            <h3 class="text-2xl font-bold text-blue-600" id="countBlue">0</h3>
                        </div>
                        <div class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center">
                            <div class="w-4 h-4 rounded-full bg-blue-600"></div>
                        </div>
                    </div>
                </div>

                <!-- Size Stats -->
                <div class="mb-6">
                    <h3 class="text-xs font-bold text-gray-500 uppercase mb-2 px-1">Resumo por Tamanho</h3>
                    <div class="grid grid-cols-4 md:grid-cols-8 gap-3" id="sizeStatsContainer">
                        <!-- Populated by JS -->
                    </div>
                </div>

                <!-- Table -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="w-full text-left border-collapse">
                            <thead>
                                <tr
                                    class="bg-gray-50 text-gray-600 text-xs uppercase tracking-wider border-b border-gray-200">
                                    <th class="p-4 font-semibold">Nome</th>
                                    <th class="p-4 font-semibold text-center">Tam.</th>
                                    <th class="p-4 font-semibold text-center">Cor</th>
                                    <th class="p-4 font-semibold text-center">Status</th>
                                    <th class="p-4 font-semibold text-right">Valor</th>
                                    <th class="p-4 font-semibold text-center">Ações</th>
                                </tr>
                            </thead>
                            <tbody id="tableBody" class="text-sm divide-y divide-gray-100">
                                <!-- Rows generated by JS -->
                                <tr>
                                    <td colspan="6" class="p-8 text-center text-gray-400">
                                        <i class="fas fa-circle-notch fa-spin mb-2"></i> Carregando dados...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- ADD/EDIT MODAL -->
    <div id="entryModal"
        class="fixed inset-0 z-50 bg-black/50 hidden flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-md overflow-hidden">
            <div class="bg-gray-50 px-6 py-4 border-b border-gray-100 flex justify-between items-center">
                <h3 class="font-bold text-lg text-gray-800" id="modalTitle">Adicionar Pessoa</h3>
                <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600"><i
                        class="fas fa-times"></i></button>
            </div>

            <div class="p-6 space-y-4">
                <input type="hidden" id="editDocId">

                <div>
                    <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Nome</label>
                    <input type="text" id="inputName"
                        class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
                        placeholder="Ex: Maria JosÃ©">
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Tamanho</label>
                        <select id="inputSize"
                            class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none bg-white">
                            <option value="PP">PP</option>
                            <option value="P">P</option>
                            <option value="M">M</option>
                            <option value="G" selected>G</option>
                            <option value="GG">GG</option>
                            <option value="XG">XG</option>
                            <option value="XGG">XGG</option>
                            <option value="EG">EG</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Cor</label>
                        <select id="inputColor"
                            class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none bg-white">
                            <option value="VERDE">VERDE</option>
                            <option value="AZUL">AZUL</option>
                            <option value="NÃƒO INFORMADO">OUTRO</option>
                        </select>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4 items-center">
                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Valor (R$)</label>
                        <input type="number" id="inputValue" step="0.01"
                            class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
                            value="16.00">
                    </div>
                    <div class="flex items-center mt-5">
                        <label class="inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="inputPaid" class="sr-only peer">
                            <div
                                class="relative w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-500">
                            </div>
                            <span class="ms-3 text-sm font-medium text-gray-700">Pago (PG)</span>
                        </label>
                    </div>
                </div>

            </div>

            <div class="bg-gray-50 px-6 py-4 flex justify-end gap-2">
                <button onclick="closeModal()"
                    class="px-4 py-2 rounded-lg text-gray-600 hover:bg-gray-200 font-medium">Cancelar</button>
                <button onclick="saveEntry()"
                    class="px-4 py-2 rounded-lg bg-blue-600 text-white font-bold hover:bg-blue-700 shadow-lg">Salvar</button>
            </div>
        </div>
    </div>

    <!-- Notification Toast -->
    <div id="toast"
        class="fixed bottom-4 right-4 bg-gray-800 text-white px-6 py-3 rounded-lg shadow-xl transform translate-y-20 opacity-0 transition-all duration-300 z-50">
        <i class="fas fa-info-circle mr-2"></i> <span id="toastMsg">Mensagem</span>
    </div>

    <!-- MAIN SCRIPT (FIREBASE) -->
    <script type="module" src="js/script.js"></script>
</body>

</html>